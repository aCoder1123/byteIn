<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Management System</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
        import { firebaseConfig } from './firebase-config.js';
        
        try {
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            
            // Make Firebase functions available globally
            window.firebaseDB = db;
            window.firebaseCollection = collection;
            window.firebaseAddDoc = addDoc;
            window.firebaseGetDocs = getDocs;
            window.firebaseDoc = doc;
            window.firebaseUpdateDoc = updateDoc;
            window.firebaseDeleteDoc = deleteDoc;
            
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.error('Firebase initialization error:', error);
            console.log('Please check your firebase-config.js file and update the configuration');
        }
    </script>
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="nav-bar">
            <div class="nav-container">
                <h1 class="nav-title">Map Generator</h1>
                <div class="nav-controls">
                    <button id="dashboard-btn" class="nav-btn active">Dashboard</button>
                    <button id="admin-btn" class="nav-btn">Map Generator</button>
                </div>
            </div>
        </nav>

        <!-- Dashboard Screen -->
        <div id="dashboard-screen" class="screen active">
            <div class="dashboard-container">
                <div class="floor-selector">
                    <h2>Select Floor</h2>
                    <div class="floor-buttons">
                        <button class="floor-btn active" data-floor="1">Floor 1</button>
                        <button class="floor-btn" data-floor="2">Floor 2</button>
                        <button class="floor-btn" data-floor="3">Floor 3</button>
                    </div>
                </div>
                
                <div class="floor-map-container">
                    <h3 id="current-floor-title">Floor 1</h3>
                    <div id="table-map" class="table-map">
                        <!-- Maps will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Screen -->
        <div id="admin-screen" class="screen">
            <div class="admin-container">
                <div class="admin-header">
                    <h2>Map Generator</h2>
                    <div class="map-selection-section">
                        <h3>Load Existing Map</h3>
                        <div class="map-selection-controls">
                            <select id="map-select" class="map-dropdown">
                                <option value="">Choose existing map...</option>
                            </select>
                            <button id="load-selected-map-btn" class="load-map-btn" disabled>Load Map</button>
                            <button id="refresh-maps-btn" class="refresh-btn">Refresh List</button>
                        </div>
                    </div>
                </div>

                <!-- Map Generator Mode -->
                <div id="map-generator-mode" class="admin-mode">
                    <div class="map-generator-container">
                        <div class="upload-section">
                            <h3>Upload Floor Map Image</h3>
                            <div class="upload-area" id="upload-area">
                                <input type="file" id="map-image-input" accept="image/*" style="display: none;">
                                <div class="upload-placeholder">
                                    <p>Click to upload floor map image</p>
                                    <p class="upload-hint">Supported formats: JPG, PNG, GIF</p>
                                    <p class="upload-hint">Or drag and drop an image here</p>
                                </div>
                            </div>
                            <input type="file" id="map-file-input" accept=".json" style="display: none;">
                        </div>

                        <div class="component-tools">
                            <h3>Component Tools</h3>
                            <div class="tool-buttons">
                                <button id="add-table-btn" class="tool-btn active" data-type="add">
                                    <span class="tool-icon">ðŸª‘</span>
                                    Add Table
                                </button>
                                <button id="assign-tool-btn" class="tool-btn" data-type="assign">
                                    <span class="tool-icon">ðŸ”‘</span>
                                    Assign
                                </button>
                            </div>
                        </div>

                        <div class="map-canvas-container">
                            <div class="canvas-header">
                                <h4>Floor Map</h4>
                                <button id="fullscreen-btn" class="fullscreen-btn" title="Toggle Fullscreen">
                                    <span class="fullscreen-icon">â›¶</span>
                                </button>
                            </div>
                            <div id="map-canvas" class="map-canvas">
                                <div class="canvas-placeholder">
                                    <p>Upload an image to start creating your map</p>
                                </div>
                            </div>
                        </div>

                        <div class="component-properties" id="component-properties" style="display: none;">
                            <h3>Component Properties</h3>
                            <div class="property-form">
                                <div class="form-group">
                                    <label for="component-name">Name/Number:</label>
                                    <input type="text" id="component-name" placeholder="Table 1, Zone A, etc.">
                                </div>
                                <div class="form-group">
                                    <label for="component-capacity">Capacity:</label>
                                    <input type="number" id="component-capacity" min="1" placeholder="2">
                                </div>
                                <div class="form-actions">
                                    <button id="save-component-btn" class="action-btn save-btn">Save Component</button>
                                    <button id="delete-component-btn" class="action-btn delete-btn">Delete</button>
                                </div>
                            </div>
                        </div>

                        <div class="map-actions">
                            <button id="save-map-firebase-btn" class="action-btn save-map-btn">Save to Firebase</button>
                            <button id="download-map-btn" class="action-btn download-btn">Download Map</button>
                            <button id="upload-map-btn" class="action-btn upload-map-btn">Upload Map File</button>
                            <button id="sync-map-btn" class="action-btn sync-btn">Sync with Tables</button>
                            <button id="reset-map-btn" class="action-btn reset-btn">Reset Map</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
