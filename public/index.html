<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Management System</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/favicon.ico">
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, getDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
        import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js';
        import { firebaseConfig } from './scripts/config.js';
        
        try {
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);
            
            // Make Firebase functions available globally
            window.firebaseDB = db;
            window.firebaseAuth = auth;
            window.firebaseCollection = collection;
            window.firebaseAddDoc = addDoc;
            window.firebaseGetDocs = getDocs;
            window.firebaseDoc = doc;
            window.firebaseUpdateDoc = updateDoc;
            window.firebaseDeleteDoc = deleteDoc;
            window.firebaseSetDoc = setDoc;
            window.firebaseGetDoc = getDoc;
            window.firebaseOnAuthStateChanged = onAuthStateChanged;
            window.firebaseSignOut = signOut;
            window.firebaseOnSnapshot = onSnapshot;
            
            // Mark Firebase as initialized
            window.firebaseInitialized = true;
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }
    </script>
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="nav-bar">
            <div class="nav-container">
                <h1 class="nav-title">Byte-In</h1>
                <div class="nav-controls">
                    <button id="dashboard-btn" class="nav-btn active">Dashboard</button>
                    <button id="maps-btn" class="nav-btn">Maps Overview</button>
                    <button id="admin-btn" class="nav-btn admin-only" style="display: none;">Map Generator</button>
                    <button id="login-btn" class="nav-btn login-btn">Login</button>
                    <button id="logout-btn" class="nav-btn logout-btn" style="display: none;">Logout</button>
                </div>
            </div>
        </nav>

        <!-- Dashboard Screen -->
        <div id="dashboard-screen" class="screen active">
            <div class="dashboard-container">
                <div class="floor-selector">
                    <h2>Select Floor</h2>
                    <div class="floor-buttons">
                        <button class="floor-btn active" data-floor="1">Floor 1</button>
                        <button class="floor-btn" data-floor="2">Floor 2</button>
                        <button class="floor-btn" data-floor="3">Floor 3</button>
                    </div>
                </div>
                
                <div class="floor-map-container">
                    <h3 id="current-floor-title">Floor 1</h3>
                    <div id="table-map" class="table-map">
                        <!-- Maps will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Maps Overview Screen -->
        <div id="maps-screen" class="screen">
            <div class="maps-container">
                <div class="maps-header">
                    <h2>Maps Overview</h2>
                    <p>View and manage all your floor maps</p>
                    <div class="maps-controls">
                        <button id="refresh-maps-overview-btn" class="action-btn refresh-btn">Refresh</button>
                        <button id="create-new-map-btn" class="action-btn create-btn">Create New Map</button>
                    </div>
                </div>
                
                <div class="maps-grid" id="maps-grid">
                    <div class="loading-placeholder">Loading maps...</div>
                </div>
            </div>
        </div>

        <!-- Admin Screen -->
        <div id="admin-screen" class="screen">
            <div class="admin-container">
                <div class="admin-header">
                    <h2>Map Generator</h2>
                    <div class="map-selection-section">
                        <h3>Load Existing Map</h3>
                        <div class="map-selection-controls">
                            <select id="map-select" class="map-dropdown">
                                <option value="">Choose existing map...</option>
                            </select>
                            <button id="load-selected-map-btn" class="load-map-btn" disabled>Load Map</button>
                            <button id="refresh-maps-btn" class="refresh-btn">Refresh List</button>
                        </div>
                    </div>
                </div>

                <!-- Map Generator Mode -->
                <div id="map-generator-mode" class="admin-mode">
                    <div class="map-generator-container">
                        <!-- Left Sidebar -->
                        <div class="map-sidebar left-sidebar">
                            <div class="floor-settings">
                                <h3>Floor Settings</h3>
                                <div class="form-group">
                                    <label for="floor-number-input">Floor Number:</label>
                                    <input type="number" id="floor-number-input" min="1" max="99" placeholder="Enter floor number" value="1">
                                </div>
                            </div>

                            <div class="upload-section">
                                <h3>Upload Floor Map</h3>
                                <div class="upload-area" id="upload-area">
                                    <input type="file" id="map-image-input" accept="image/*" style="display: none;">
                                    <div class="upload-placeholder">
                                        <p>Click or drag image to upload</p>
                                        <p class="upload-hint">JPG, PNG, GIF</p>
                                    </div>
                                </div>
                                <input type="file" id="map-file-input" accept=".json" style="display: none;">
                            </div>

                            <div class="component-tools">
                                <h3>Component Tools</h3>
                                <div class="tool-buttons">
                                    <button id="add-table-btn" class="tool-btn active" data-type="add">
                                        Add Table
                                    </button>
                                    <button id="assign-tool-btn" class="tool-btn" data-type="assign">
                                        Assign
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Component Properties MOVED HERE -->
                            <div class="component-properties" id="component-properties" style="display: none;">
                                <h3>Component Properties</h3>
                                <div class="property-form">
                                    <div class="form-group">
                                        <label for="component-number">Table Number:</label>
                                        <input type="number" id="component-number" min="1" placeholder="1">
                                    </div>
                                    <div class="form-actions">
                                        <button id="save-component-btn" class="action-btn save-btn">Save Component</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Main Content -->
                        <div class="map-main-content">
                            <div class="map-canvas-container">
                                <div class="canvas-header">
                                    <h4>Floor Map</h4>
                                    <button id="fullscreen-btn" class="fullscreen-btn" title="Toggle Fullscreen">
                                        <span class="fullscreen-icon">â›¶</span>
                                    </button>
                                </div>
                                <div id="map-canvas" class="map-canvas">
                                    <div class="canvas-placeholder">
                                        <p>Upload an image to start creating your map</p>
                                    </div>
                                </div>
                            </div>
                             <div class="map-actions">
                                <button id="save-map-firebase-btn" class="action-btn save-map-btn">Save</button>
                                <button id="test-firebase-btn" class="action-btn" style="background-color: #9b59b6;">Test Firebase</button>
                                <button id="download-map-btn" class="action-btn download-btn">Download Map</button>
                                <button id="sync-map-btn" class="action-btn sync-btn">Sync with Tables</button>
                                <button id="reset-map-btn" class="action-btn reset-btn">Reset Map</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NFC Writer Modal -->
    <div id="nfc-writer-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content nfc-modal">
            <div class="modal-header">
                <h3>Assign NFC Tag</h3>
                <button id="close-nfc-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="nfc-assignment-info">
                    <p><strong>Component:</strong> <span id="nfc-component-name">-</span></p>
                    <p><strong>Floor:</strong> <span id="nfc-floor-number">-</span></p>
                </div>
                
                <div class="nfc-config-section">
                    <h4>NFC Configuration</h4>
                    <div class="form-group">
                        <label for="nfc-api-key">API Key:</label>
                        <input type="text" id="nfc-api-key" placeholder="Enter API key">
                    </div>
                    <div class="form-group">
                        <label for="nfc-ssid">WiFi SSID:</label>
                        <input type="text" id="nfc-ssid" placeholder="Enter WiFi network name">
                    </div>
                    <div class="form-group">
                        <label for="nfc-network-password">WiFi Password:</label>
                        <input type="password" id="nfc-network-password" placeholder="Enter WiFi password">
                    </div>
                </div>
                
                <div class="nfc-status" id="nfc-status">
                    <div class="status-message">
                        <p>Ready to write NFC tag</p>
                        <p class="device-info">Note: NFC writing works best on Android devices</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="write-nfc-btn" class="action-btn primary-btn">Write NFC Tag</button>
                <button id="cancel-nfc-btn" class="action-btn secondary-btn">Cancel</button>
            </div>
        </div>
    </div>

    <script src="scripts/script.js"></script>
</body>
</html>